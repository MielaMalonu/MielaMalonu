document.addEventListener("DOMContentLoaded",async function(){console.log("‚úÖ Admin panel loaded");const r={SUPABASE:{URL:"https://supa.mielamalonu.com/api/supabase/",API_KEY:"cbb"},DISCORD:{CLIENT_ID:"1263389179249692693",REDIRECT_URI:window.location.origin+window.location.pathname,SCOPE:"identify"},ALLOWED_ADMIN_IDS:["959449311366766622","495602170507296778","1365306133212037213","1239451180350832731","1074654443338993764"],AUTH_KEY:"miela_malonu_auth"},a=1;let s=[],n=[],o="offline",i="u≈ædaryta",c=null;function l(t,e="info"){document.getElementById("notification-container")||((a=document.createElement("div")).id="notification-container",a.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        `,document.body.appendChild(a));var a=document.getElementById("notification-container");const n=document.createElement("div");switch(n.classList.add("notification","notification-"+e),n.style.cssText=`
        padding: 15px 20px;
        border-radius: 8px;
        margin-bottom: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 280px;
        max-width: 400px;
        opacity: 0;
        transform: translateX(30px);
        transition: all 0.3s ease;
        animation: slideIn 0.3s forwards;
    `,e){case"success":n.style.background="linear-gradient(135deg, #4CAF50, #2E7D32)",n.style.color="white";break;case"error":n.style.background="linear-gradient(135deg, #F44336, #C62828)",n.style.color="white";break;case"warning":n.style.background="linear-gradient(135deg, #FF9800, #EF6C00)",n.style.color="white";break;default:n.style.background="linear-gradient(135deg, #2196F3, #0D47A1)",n.style.color="white"}n.innerHTML=`
        <span>${t}</span>
        <button style="background: none; border: none; color: white; cursor: pointer; margin-left: 10px; font-size: 18px;">√ó</button>
    `,n.querySelector("button").addEventListener("click",()=>{n.style.opacity="0",n.style.transform="translateX(30px)",setTimeout(()=>n.remove(),300)}),a.appendChild(n);e=document.createElement("style");e.innerHTML=`
        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    `,document.head.appendChild(e),setTimeout(()=>{n.parentElement&&(n.style.opacity="0",n.style.transform="translateX(30px)",setTimeout(()=>n.remove(),300))},5e3)}function d({title:t,message:e,customContent:a,inputField:n=!1,confirmText:o="Gerai",cancelText:i="At≈°aukti",onConfirm:r,onCancel:s}){const c=document.createElement("div"),l=(c.className="popup-container",document.createElement("div"));l.className="popup";var d=document.createElement("div"),u=(d.className="popup-header",document.createElement("h3")),t=(u.textContent=t,d.appendChild(u),document.createElement("button")),u=(t.className="popup-close",t.innerHTML="&times;",t.addEventListener("click",()=>{m(),s&&s()}),document.createElement("div"));u.className="popup-content",a?u.innerHTML=a:e&&(u.textContent=e);let p;n&&((p=document.createElement("textarea")).className="popup-input",p.style.width="100%",p.style.padding="10px",p.style.borderRadius="8px",p.style.marginTop="15px",p.style.background="rgba(30, 30, 30, 0.7)",p.style.color="white",p.style.border="1px solid rgba(80, 80, 80, 0.5)");a=document.createElement("div"),a.className="popup-actions",i&&"none"!==i&&((e=document.createElement("button")).textContent=i,e.className="cancel",e.addEventListener("click",()=>{m(),s&&s()}),a.appendChild(e)),i=document.createElement("button");function m(){c.classList.remove("active"),l.classList.remove("active"),setTimeout(()=>{c.remove()},300)}i.textContent=o,i.className="confirm",i.addEventListener("click",()=>{m(),r&&(n?r(p.value):r())}),a.appendChild(i),l.appendChild(t),l.appendChild(d),l.appendChild(u),n&&l.appendChild(p),l.appendChild(a),c.appendChild(l),document.body.appendChild(c),setTimeout(()=>{c.classList.add("active"),l.classList.add("active")},10)}async function t(){var t,e=new URLSearchParams(window.location.hash.substring(1)).get("access_token"),a=new URLSearchParams(window.location.search).get("code");if(console.log("Auth check - Token:",e,"Code:",a),e){window.history.replaceState({},document.title,window.location.pathname);try{var n=await fetch("https://discord.com/api/users/@me",{headers:{authorization:"Bearer "+e}});if(!n.ok)throw new Error("Failed to get Discord user data");var o=await n.json();console.log("‚úÖ Discord user data received:",o),r.ALLOWED_ADMIN_IDS.includes(o.id)?(c=o,t=o,localStorage.setItem(r.AUTH_KEY,JSON.stringify(t)),console.log("‚úÖ Authentication stored in local storage"),h(),await g(),await f(),await E(),await C(),await S(),D(),u(o.username)):p("Neturite teisi≈≥ prieiti prie administracijos puslapio.")}catch(t){console.error("‚ùå Error processing Discord auth:",t),p("ƒÆvyko klaida autentifikuojant per Discord.")}}else a&&(console.log("Authorization code found, but this implementation uses implicit flow"),p("Netinkamas autorizacijos metodas. Pra≈°ome susisiekti su administratoriumi."))}function u(t){var e=document.querySelector(".admin-panel"),a=document.createElement("p");a.className="welcome-message",a.textContent=`Sveiki, ${t}!`,e.insertBefore(a,e.firstChild)}function p(t){var e=document.querySelector(".auth-overlay"),a=document.createElement("p");a.className="auth-error",a.textContent=t,a.style.color="#ff5555",a.style.marginTop="10px",document.querySelectorAll(".auth-error").forEach(t=>t.remove()),(e||(y(),document.querySelector(".auth-overlay"))).appendChild(a)}function m(){localStorage.removeItem(r.AUTH_KEY),c=null,console.log("üîÑ Authentication cleared from local storage")}function h(){document.querySelectorAll("body > *").forEach(t=>{t.classList.contains("auth-overlay")||(t.style.display="")});var t,e=document.querySelector(".auth-overlay");e&&e.remove(),e=document.querySelector(".admin-panel"),document.getElementById("logoutButton")||((t=document.createElement("button")).id="logoutButton",t.textContent="üö™ Atsijungti",t.addEventListener("click",function(){m(),location.reload()}),e.appendChild(t))}function y(){var t,e,a;document.querySelectorAll("body > *").forEach(t=>{t.classList.contains("auth-overlay")||(t.style.display="none")}),document.querySelector(".auth-overlay")||((t=document.createElement("div")).className="auth-overlay",(e=document.createElement("h2")).textContent="Admin prisijungimas",(a=document.createElement("button")).className="discord-login-button",a.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.54 0c1.356 0 2.46 1.104 2.46 2.472v21.528l-2.58-2.28-1.452-1.344-1.536-1.428.636 2.22h-13.608c-1.356 0-2.46-1.104-2.46-2.472v-16.224c0-1.368 1.104-2.472 2.46-2.472h16.08zm-4.632 15.672c2.652-.084 3.672-1.824 3.672-1.824 0-3.864-1.728-6.996-1.728-6.996-1.728-1.296-3.372-1.26-3.372-1.26l-.168.192c2.04.624 2.988 1.524 2.988 1.524-1.248-.684-2.472-1.02-3.612-1.152-.864-.096-1.692-.072-2.424.024l-.204.024c-.42.036-1.44.192-2.724.756-.444.204-.708.348-.708.348s.996-.948 3.156-1.572l-.12-.144s-1.644-.036-3.372 1.26c0 0-1.728 3.132-1.728 6.996 0 0 1.008 1.74 3.66 1.824 0 0 .444-.54.804-.996-1.524-.456-2.1-1.416-2.1-1.416l.336.204.048.036.047.027.014.006.047.027c.3.168.6.3.876.408.492.192 1.08.384 1.764.516.9.168 1.956.228 3.108.012.564-.096 1.14-.264 1.74-.516.42-.156.888-.384 1.38-.708 0 0-.6.984-2.172 1.428.36.456.792.972.792.972zm-5.58-5.604c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332.012-.732-.54-1.332-1.224-1.332zm4.38 0c-.684 0-1.224.6-1.224 1.332 0 .732.552 1.332 1.224 1.332.684 0 1.224-.6 1.224-1.332 0-.732-.54-1.332-1.224-1.332z" fill="currentColor"></path></svg> Prisijungti su Discord',a.addEventListener("click",function(){window.location.href=`https://discord.com/api/oauth2/authorize?client_id=${r.DISCORD.CLIENT_ID}&redirect_uri=${encodeURIComponent(r.DISCORD.REDIRECT_URI)}&response_type=token&scope=`+r.DISCORD.SCOPE}),t.appendChild(e),t.appendChild(a),document.body.appendChild(t))}async function g(){try{var t=await fetch(r.SUPABASE.URL+"/IC",{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(!t.ok)throw new Error("‚ö†Ô∏è Failed to fetch data");b(s=await t.json())}catch(t){console.error("‚ùå Error fetching Supabase data:",t),alert("‚ö†Ô∏è Nepavyko gauti duomen≈≥ i≈° duombazƒós.")}}async function f(){try{var t=await fetch(`${r.SUPABASE.URL}/Blacklist?id=eq.${a}&select=blacklist`,{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(!t.ok)throw new Error("‚ö†Ô∏è Failed to fetch blacklist data");var e=await t.json();0<e.length?(n=e[0].blacklist||[],console.log("üìú Current Blacklist:",n)):(console.log("‚ùå No blacklist found in Supabase."),n=[])}catch(t){console.error("‚ùå Error fetching blacklist:",t),alert("‚ö†Ô∏è Nepavyko gauti duomen≈≥ i≈° duombazƒós.")}}async function E(){try{var t=await fetch(`${r.SUPABASE.URL}/Status?id=eq.${a}&select=status`,{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(!t.ok)throw new Error("‚ö†Ô∏è Failed to fetch status");var e=await t.json();0<e.length?"boolean"==typeof(o=e[0].status)&&(o=o?"online":"offline"):o="offline",I()}catch(t){console.error("‚ùå Error fetching status:",t)}}async function S(){try{var t=await fetch(r.SUPABASE.URL+"/ID?id=eq.1&select=statusas",{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(!t.ok)throw new Error("‚ö†Ô∏è Failed to fetch ID status");var e=await t.json();0<e.length?(i=e[0].statusas||"u≈ædaryta",console.log("üìú Current ID Status:",i)):(i="u≈ædaryta",console.log("‚ùó No ID status found, defaulting to 'u≈ædaryta'")),A()}catch(t){console.error("‚ùå Error fetching ID status:",t)}}async function v(){i="atidaryta"===i?"u≈ædaryta":"atidaryta",A();try{if(!(await fetch(r.SUPABASE.URL+"/ID?id=eq.1",{method:"PATCH",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"},body:JSON.stringify({statusas:i})})).ok)throw new Error("‚ö†Ô∏è Failed to update ID status");console.log("üîÑ ID Status changed to: "+i),alert("‚úÖ ID Statusas pakeistas ƒØ: "+i)}catch(t){console.error("‚ùå Error updating ID status:",t),alert("‚ö†Ô∏è Nepavyko atnaujinti ID statuso.")}}function A(){var t=document.getElementById("idStatusDisplay");t&&("atidaryta"===i?(t.textContent="‚úÖ IDS atidaryta ‚úÖ",t.classList.remove("status-offline"),t.classList.add("status-online")):(t.textContent="‚ùå IDS u≈ædaryta ‚ùå",t.classList.remove("status-online"),t.classList.add("status-offline")))}function I(){var t=document.getElementById("statusDisplay");"online"===o?t.textContent="‚úÖ Anketos atidarytos. ‚úÖ":t.textContent="‚ùå Anketos u≈ædarytos. ‚ùå",t.classList.toggle("status-online","online"===o),t.classList.toggle("status-offline","offline"===o)}function b(o){const i=document.querySelector("#data-table tbody");i.innerHTML="";var t,e=document.querySelector("#data-table thead tr"),e=(e&&!e.querySelector("th:nth-child(9)")&&((t=document.createElement("th")).textContent="Rolƒó",e.appendChild(t)),document.createElement("tr"));e.id="loading-indicator",e.innerHTML='<td colspan="10" style="text-align: center;">Kraunama vartotoj≈≥ roli≈≥ informacija...</td>',i.appendChild(e);(async()=>{for(let t=0;t<o.length;t++){var e=o[t],a=await async function(t){try{var e=await fetch("https://mielamalonu-rolecheck1-production.up.railway.app/api/check-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})});if(e.ok)return(await e.json()).hasRole||!1;throw new Error("‚ö†Ô∏è Failed to check user role")}catch(t){return console.error("‚ùå Error checking user role:",t),!1}}(e.DISCORD_ID),n=document.createElement("tr"),e=(n.innerHTML=`
                <td>${t+1}.</td>
                <td><span class="copy-text" data-copy="${e.DISCORD_ID}">${e.DISCORD_ID}</span></td>
                <td><span class="copy-text" data-copy="${e.USERIS}">${e.USERIS}</span></td>
                <td><span class="copy-text" data-copy="${e.VARDAS}">${e.VARDAS}</span></td>
                <td><span class="copy-text" data-copy="${e.PAVARDƒñ}">${e.PAVARDƒñ}</span></td>
                <td><span class="copy-text" data-copy="${e["STEAM NICKAS"]}">${e["STEAM NICKAS"]}</span></td>
                <td>
                    <a href="${e["STEAM LINKAS"]}" target="_blank">üîó Steam Profilis</a>
                    <span class="copy-text" data-copy="${e["STEAM LINKAS"]}">üìã</span>
                </td>
                <td>
                    <button class="warning-button" data-user-id="${e.DISCORD_ID}" data-user-name="${e.USERIS}">‚ö†Ô∏è</button>
                    <button class="view-warnings-button" data-user-id="${e.DISCORD_ID}" data-user-name="${e.USERIS}">üìã</button>
                    <button class="delete-row-button" data-user-id="${e.DISCORD_ID}" title="I≈°trinti vartotojƒÖ">üóëÔ∏è</button>
                </td>
                <td class="role-status ${a?"has-role":"no-role"}">
                    ${a?"‚úì":"‚ùå"}
                </td>
            `,i.appendChild(n),i.lastElementChild);e.querySelector(".warning-button").addEventListener("click",w),e.querySelector(".view-warnings-button").addEventListener("click",function(){x(this.getAttribute("data-user-id"),this.getAttribute("data-user-name"))}),e.querySelector(".delete-row-button").addEventListener("click",function(){!async function(e){d({title:"I≈°trinti vartotojƒÖ",message:"Ar tikrai norite i≈°trinti ≈°ƒØ vartotojƒÖ i≈° duomen≈≥ bazƒós?",confirmText:"I≈°trinti",onConfirm:async()=>{try{if(!(await fetch(r.SUPABASE.URL+"/IC?DISCORD_ID=eq."+e,{method:"DELETE",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}})).ok)throw new Error("‚ö†Ô∏è Failed to delete user");b(s=s.filter(t=>t.DISCORD_ID!==e)),l("‚úÖ Vartotojas sƒókmingai i≈°trintas!","success")}catch(t){console.error("‚ùå Error deleting user:",t),l("‚ö†Ô∏è Nepavyko i≈°trinti vartotojo.","error")}}})}(this.getAttribute("data-user-id"))}),e.querySelectorAll(".copy-text").forEach(t=>{t.addEventListener("click",function(){var t=this.getAttribute("data-copy");navigator.clipboard.writeText(t).then(()=>{var t=this.textContent;this.classList.add("copy-flash"),"üìã"!==this.textContent?(this.setAttribute("data-original-text",t),this.textContent="Nukopijuota ‚úÖ"):this.textContent="‚úì",setTimeout(()=>{this.classList.remove("copy-flash"),this.hasAttribute("data-original-text")?(this.textContent=this.getAttribute("data-original-text"),this.removeAttribute("data-original-text")):"‚úì"===this.textContent&&(this.textContent="üìã")},1e3)}).catch(t=>{console.error("Failed to copy: ",t)})})})}var t=document.getElementById("loading-indicator");t&&t.remove()})()}document.getElementById("searchInput").addEventListener("input",function(){const e=this.value.toLowerCase();if(s&&0<s.length)try{var t=s.filter(t=>!!t&&Object.entries(t).some(([,t])=>null!=t&&String(t).toLowerCase().includes(e)));const n=document.querySelector("#data-table tbody");n&&(n.innerHTML="",t.forEach((t,e)=>{var a=document.createElement("tr");a.innerHTML=`
                        <td>${e+1}.</td>
                        <td><span class="copy-text" data-copy="${t.DISCORD_ID}">${t.DISCORD_ID}</span></td>
                        <td><span class="copy-text" data-copy="${t.USERIS}">${t.USERIS}</span></td>
                        <td><span class="copy-text" data-copy="${t.VARDAS}">${t.VARDAS}</span></td>
                        <td><span class="copy-text" data-copy="${t.PAVARDƒñ}">${t.PAVARDƒñ}</span></td>
                        <td><span class="copy-text" data-copy="${t["STEAM NICKAS"]}">${t["STEAM NICKAS"]}</span></td>
                        <td>
                            <a href="${t["STEAM LINKAS"]}" target="_blank">üîó Steam Profilis</a>
                            <span class="copy-text" data-copy="${t["STEAM LINKAS"]}">üìã</span>
                        </td>
                        <td>
                            <button class="warning-button" data-user-id="${t.DISCORD_ID}" data-user-name="${t.USERIS}">‚ö†Ô∏è</button>
                            <button class="view-warnings-button" data-user-id="${t.DISCORD_ID}" data-user-name="${t.USERIS}">üìã</button>
                        </td>
                    `,n.appendChild(a)}),document.querySelectorAll(".warning-button").forEach(t=>{t.addEventListener("click",w)}),document.querySelectorAll(".view-warnings-button").forEach(t=>{t.addEventListener("click",function(){x(this.getAttribute("data-user-id"),this.getAttribute("data-user-name"))})}),T())}catch(t){console.error("Error filtering data:",t),l("‚ö†Ô∏è Klaida filtruojant duomenis.","error")}});var e=document.createElement("style"),e=(e.textContent=`
    .delete-row-button {
          background-color: #ff3333;
    color: white;
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.2);
    }
    
    .delete-row-button:hover {
      background-color: #cc0000;
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
    }
    
    .delete-row-button:active {
        transform: scale(0.95);
    }
`,document.head.appendChild(e),document.createElement("style"));async function w(){const a=this.getAttribute("data-user-id"),n=this.getAttribute("data-user-name");d({title:"ƒÆspƒójimo pridƒójimas",message:`ƒÆveskite ƒØspƒójimo prie≈æastƒØ vartotojui ${n}:`,inputField:!0,confirmText:"Pridƒóti ƒØspƒójimƒÖ",onConfirm:async t=>{if(t&&""!==t.trim()){var e=(new Date).toISOString().split("T")[0],e={ID:a,DATA:e,"PRIE≈ΩASTIS":t};try{if(!(await fetch(r.SUPABASE.URL+"Ispejimai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("‚ö†Ô∏è Failed to create warning");l(`‚úÖ ƒÆspƒójimas vartotojui ${n} sƒókmingai sukurtas!`,"success"),this.textContent="‚úì",setTimeout(()=>{this.textContent="‚ö†Ô∏è"},2e3)}catch(t){console.error("‚ùå Error creating warning:",t),l("‚ö†Ô∏è Nepavyko sukurti ƒØspƒójimo.","error")}}else l("‚ö†Ô∏è ƒÆspƒójimas nebuvo sukurtas. Prie≈æastis yra privaloma.","error")}})}async function C(){try{var t,e,a=await fetch(r.SUPABASE.URL+"/Event?id=eq.1&select=IDs",{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(a.ok)return 0<(t=await a.json()).length&&t[0].IDs?(e=t[0].IDs,console.log("üìú Current Event IDs:",e),k(e),e):(console.log("‚ùó No event IDs found"),k([]),[]);throw new Error("‚ö†Ô∏è Failed to fetch event IDs")}catch(t){return console.error("‚ùå Error fetching event IDs:",t),alert("‚ö†Ô∏è Unable to fetch event IDs."),[]}}function k(t){var e=document.getElementById("event-ids-display");if(e.innerHTML="",t&&0!==t.length){const n=t.join(", ");var a=document.createElement("h3"),a=(a.textContent="Event IDs:",a.className="ids-title",e.appendChild(a),document.createElement("button"));a.className="copy-all-button",a.textContent="üìã Kopijuoti visus",a.style.marginTop="8px",a.addEventListener("click",function(){navigator.clipboard.writeText(n).then(()=>{this.textContent="‚úÖ Nukopijuota!",setTimeout(()=>{this.textContent="üìã Kopijuoti visus"},1e3)}).catch(t=>{console.error("Failed to copy: ",t),this.textContent="‚ùå Nepavyko kopijuoti",setTimeout(()=>{this.textContent="üìã Kopijuoti visus"},1e3)})}),e.appendChild(a);const o=document.createElement("div");o.className="individual-ids-container",o.style.display="flex",o.style.flexWrap="wrap",o.style.gap="5px",o.style.marginTop="10px",t.forEach(t=>{var e=document.createElement("div");e.className="event-id-tag copy-text",e.setAttribute("data-copy",t),e.textContent=t,o.appendChild(e)}),e.appendChild(o),document.querySelectorAll("#event-ids-display .copy-text").forEach(t=>{t.addEventListener("click",function(){var t=this.getAttribute("data-copy");navigator.clipboard.writeText(t).then(()=>{var t=this.textContent;this.classList.add("copy-flash"),this.setAttribute("data-original-text",t),this.textContent="Nukopijuota ‚úÖ",setTimeout(()=>{this.classList.remove("copy-flash"),this.textContent=this.getAttribute("data-original-text"),this.removeAttribute("data-original-text")},1e3)}).catch(t=>{console.error("Failed to copy: ",t)})})})}else e.innerHTML="<p class='empty-message'>Nƒóra pridƒót≈≥ ID</p>"}async function x(t,e){try{var a=await fetch(r.SUPABASE.URL+`/Ispejimai?ID=eq.${t}&order=DATA.asc`,{method:"GET",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"}});if(!a.ok)throw new Error("Failed to fetch warnings");var o=await a.json();let n="";0===o.length?n="<p>Vartotojas neturi ƒØspƒójim≈≥.</p>":o.forEach((t,e)=>{var a=t.DATA.split("T")[0];n+=`
                    <div class="warning-item">
                        <div class="warning-header">
                            <span class="warning-number">#${e+1}</span>
                            <span class="warning-date">${a}</span>
                        </div>
                        <div class="warning-reason">${t.PRIE≈ΩASTIS}</div>
                    </div>
                `}),d({title:"ƒÆspƒójimai: "+e,customContent:`<div class="warnings-list">${n}</div>`,confirmText:"U≈ædaryti",cancelText:"none"})}catch(t){console.error("Error fetching warnings:",t),l("Nepavyko gauti ƒØspƒójim≈≥.","error")}}function D(){var t=document.querySelector(".admin-panel"),e=document.createElement("p"),a=(e.id="idStatusDisplay",e.className="atidaryta"===i?"status-online":"status-offline",e.textContent="atidaryta"===i?"‚úÖ IDS atidaryta ‚úÖ":"‚ùå IDS u≈ædaryta ‚ùå",document.createElement("button")),e=(a.id="idStatusButton",a.textContent="üîÑ Keisti ID statusƒÖ",a.addEventListener("click",v),t.insertBefore(e,document.getElementById("blacklistButton")),t.insertBefore(a,document.getElementById("blacklistButton")),document.createElement("div"));e.style.margin="10px 0",t.insertBefore(e,document.getElementById("blacklistButton"))}function T(){document.querySelectorAll("#data-table .copy-text").forEach(t=>{t.addEventListener("click",function(){var t=this.getAttribute("data-copy");navigator.clipboard.writeText(t).then(()=>{var t=this.textContent;this.classList.add("copy-flash"),"üìã"!==this.textContent?(this.setAttribute("data-original-text",t),this.textContent="Nukopijuota ‚úÖ"):this.textContent="‚úì",setTimeout(()=>{this.classList.remove("copy-flash"),this.hasAttribute("data-original-text")?(this.textContent=this.getAttribute("data-original-text"),this.removeAttribute("data-original-text")):"‚úì"===this.textContent&&(this.textContent="üìã")},1e3)}).catch(t=>{console.error("Failed to copy: ",t)})})})}e.textContent=`
    .role-status {
        text-align: center;
        font-weight: bold;
    }
    .has-role {
        color: #4CAF50;
    }
    .no-role {
        color: #F44336;
    }
`,document.head.appendChild(e),document.getElementById("statusButton").addEventListener("click",async function(){o="online"===o?"offline":"online",I();try{await fetch(r.SUPABASE.URL+"/Status?id=eq."+a,{method:"PATCH",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"},body:JSON.stringify({status:o})}),console.log("üîÑ Status changed to: "+o)}catch(t){console.error("‚ùå Error updating status:",t)}}),document.getElementById("blacklistButton").addEventListener("click",async function(){d({title:"Pridƒóti ƒØ Blacklist",message:"ƒÆveskite vartotojo ID, kurƒØ norite pridƒóti ƒØ blacklist:",inputField:!0,confirmText:"Pridƒóti",onConfirm:async t=>{if(t&&""!==t.trim())if(n.includes(t))l("‚ö†Ô∏è Asmuo jau yra blackliste.","warning");else{n.push(t);try{if(!(await fetch(r.SUPABASE.URL+"/Blacklist?id=eq."+a,{method:"PATCH",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"},body:JSON.stringify({blacklist:n})})).ok)throw new Error("‚ö†Ô∏è Failed to update blacklist");l("‚úÖ Asmuo pridƒótas ƒØ BlacklistƒÖ!","success"),console.log("üìú Updated Blacklist:",n)}catch(t){console.error("‚ùå Error updating blacklist:",t),l("‚ö†Ô∏è Nepavyko atnaujinti blacklisto.","error")}}else l("‚ö†Ô∏è Negalima pridƒóti tu≈°ƒçio ID.","error")}})}),document.getElementById("removeButton").addEventListener("click",async function(){d({title:"Pa≈°alinti i≈° Blacklisto",message:"ƒÆveskite vartotojo ID, kurƒØ norite pa≈°alinti i≈° blacklisto:",inputField:!0,confirmText:"Pa≈°alinti",onConfirm:async e=>{if(e&&""!==e.trim())if(n.includes(e)){n=n.filter(t=>t!==e);try{if(!(await fetch(r.SUPABASE.URL+"/Blacklist?id=eq."+a,{method:"PATCH",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"},body:JSON.stringify({blacklist:n})})).ok)throw new Error("‚ö†Ô∏è Failed to update blacklist");l("‚úÖ Asmuo pa≈°alintas i≈° Blacklisto!","success"),console.log("üìú Updated Blacklist:",n)}catch(t){console.error("‚ùå Error updating blacklist:",t),l("‚ö†Ô∏è Nepavyko atnaujinti blacklisto.","error")}}else l("‚ö†Ô∏è Asmuo nƒóra Blackliste.","warning");else l("‚ö†Ô∏è Negalima pa≈°alinti tu≈°ƒçio ID.","error")}})}),document.getElementById("clearEventIdsButton").addEventListener("click",async function(){d({title:"I≈°valyti Event ID",message:"Ar tikrai norite i≈°valyti visus Event ID?",confirmText:"I≈°valyti",onConfirm:async()=>{try{if(!(await fetch(r.SUPABASE.URL+"/Event?id=eq.1",{method:"PATCH",headers:{apikey:r.SUPABASE.API_KEY,"Content-Type":"application/json"},body:JSON.stringify({IDs:[]})})).ok)throw new Error("‚ö†Ô∏è Failed to clear event IDs");l("‚úÖ Visi ID sƒókmingai i≈°valyti!","success"),k([])}catch(t){console.error("‚ùå Error clearing event IDs:",t),l("‚ö†Ô∏è Nepavyko i≈°valyti ID.","error")}}})}),document.getElementById("searchInput").addEventListener("input",function(){const e=this.value.toLowerCase();if(s&&0<s.length)try{var t=s.filter(t=>!!t&&Object.entries(t).some(([,t])=>null!=t&&String(t).toLowerCase().includes(e)));const n=document.querySelector("#data-table tbody");n&&(n.innerHTML="",t.forEach((t,e)=>{var a=document.createElement("tr");a.innerHTML=`
                        <td>${e+1}.</td>
                        <td><span class="copy-text" data-copy="${t.DISCORD_ID}">${t.DISCORD_ID}</span></td>
                        <td><span class="copy-text" data-copy="${t.USERIS}">${t.USERIS}</span></td>
                        <td><span class="copy-text" data-copy="${t.VARDAS}">${t.VARDAS}</span></td>
                        <td><span class="copy-text" data-copy="${t.PAVARDƒñ}">${t.PAVARDƒñ}</span></td>
                        <td><span class="copy-text" data-copy="${t["STEAM NICKAS"]}">${t["STEAM NICKAS"]}</span></td>
                        <td>
                          <a href="${t["STEAM LINKAS"]}" target="_blank">üîó Steam Profilis</a>
                          <span class="copy-text" data-copy="${t["STEAM LINKAS"]}">üìã</span>
                        </td>
<td>
  <button class="warning-button" data-user-id="${t.DISCORD_ID}" data-user-name="${t.USERIS}">‚ö†Ô∏è</button>
  <button class="view-warnings-button" data-user-id="${t.DISCORD_ID}" data-user-name="${t.USERIS}">üìã</button>
</td>
                    `,n.appendChild(a)}),document.querySelectorAll(".view-warnings-button").forEach(t=>{t.addEventListener("click",function(){x(this.getAttribute("data-user-id"),this.getAttribute("data-user-name"))})}),T(),document.querySelectorAll(".warning-button").forEach(t=>{t.addEventListener("click",w)}))}catch(t){console.error("Error filtering data:",t)}});(async()=>{console.log("üöÄ Initializing admin panel"),window.location.hash.includes("access_token=")||window.location.search.includes("code=")?(console.log("üîë OAuth callback detected"),await t()):!function(){var t=localStorage.getItem(r.AUTH_KEY);if(t)try{return c=JSON.parse(t),console.log("‚úÖ Authentication found in local storage"),1}catch(t){return console.error("‚ùå Error parsing auth data:",t),m(),0}}()?(console.log("üîì Not authenticated, showing login"),y()):(console.log("üîí Already authenticated"),h(),await g(),await f(),await E(),await C(),await S(),D(),c&&c.username&&u(c.username))})()});
